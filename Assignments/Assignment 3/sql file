USE DATABASE MY_PRACTICE_DB;
USE SCHEMA PUBLIC;

CREATE OR REPLACE TABLE EMPLOYEE_RAW (
    EMP_ID INT,
    NAME STRING,
    DEPT STRING,
    SALARY NUMBER(10,2)
);

CREATE OR REPLACE STAGE AZURE_EMP_STAGE
URL='azure://hexadatastorage.blob.core.windows.net/assign3'
CREDENTIALS=(AZURE_SAS_TOKEN='sp=rwl&st=2025-10-16T16:39:56Z&se=2025-10-17T00:54:56Z&spr=https&sv=2024-11-04&sr=c&sig=%2F7ioqEWVv14InKV99zOSa7Kl3bk5Y%2BaRXJVbIKUczmE%3D');


LIST @AZURE_EMP_STAGE;


CREATE OR REPLACE PIPE EMP_PIPE AS
COPY INTO EMPLOYEE_RAW
FROM @AZURE_EMP_STAGE
FILE_FORMAT = (TYPE = CSV FIELD_OPTIONALLY_ENCLOSED_BY='"' SKIP_HEADER=1);


ALTER PIPE EMP_PIPE REFRESH;


SELECT * FROM EMPLOYEE_RAW LIMIT 10;

LIST @AZURE_EMP_STAGE;

SELECT *
FROM TABLE(INFORMATION_SCHEMA.COPY_HISTORY(
    TABLE_NAME => 'EMPLOYEE_RAW',
    START_TIME => DATEADD('hour', -1, CURRENT_TIMESTAMP())
))
ORDER BY LAST_LOAD_TIME DESC;


SELECT * FROM EMPLOYEE_RAW LIMIT 10;



